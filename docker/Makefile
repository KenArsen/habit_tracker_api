# Docker Makefile –¥–ª—è habit_tracker_api

COMPOSE_FILE = docker-compose.yaml
APP_SERVICE = app
DB_SERVICE = db

# –¶–≤–µ—Ç–∞
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[0;33m
NC = \033[0m

.PHONY: docker-help docker-build docker-up docker-down docker-migrate docker-create-superuser docker-shell docker-clean

# –°–ø—Ä–∞–≤–∫–∞ –ø–æ Docker-–∫–æ–º–∞–Ω–¥–∞–º
docker-help:
	@echo "$(GREEN)üì¶ Docker –∫–æ–º–∞–Ω–¥—ã –¥–ª—è $(PROJECT_NAME):$(NC)"
	@echo "  $(GREEN)make docker-build$(NC)            - –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤"
	@echo "  $(GREEN)make docker-up$(NC)               - –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
	@echo "  $(GREEN)make docker-down$(NC)             - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤"
	@echo "  $(GREEN)make docker-migrate$(NC)          - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"
	@echo "  $(GREEN)make docker-create-superuser$(NC) - –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
	@echo "  $(GREEN)make docker-shell$(NC)            - Bash –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"
	@echo "  $(GREEN)make docker-clean$(NC)            - –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker –∏ –∫—ç—à–∞"

# –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤
docker-build:
	@echo "$(GREEN)üîß –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤...$(NC)"
	docker-compose -f $(COMPOSE_FILE) build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-up:
	@echo "$(GREEN)üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...$(NC)"
	docker-compose -f $(COMPOSE_FILE) up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-down:
	@echo "$(RED)‚õî –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...$(NC)"
	docker-compose -f $(COMPOSE_FILE) down

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker-migrate:
	@echo "$(GREEN)üì¶ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞...$(NC)"
	docker-compose -f $(COMPOSE_FILE) exec $(APP_SERVICE) alembic upgrade head

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker-create-superuser:
	@echo "$(GREEN)üë§ –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...$(NC)"
	docker-compose -f $(COMPOSE_FILE) exec $(APP_SERVICE) python /app/scripts/create_superuser.py

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ bash
docker-shell:
	@echo "$(GREEN)üíª –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É...$(NC)"
	docker-compose -f $(COMPOSE_FILE) exec $(APP_SERVICE) /bin/bash

# –û—á–∏—Å—Ç–∫–∞ Docker –∏ Python –∫—ç—à–∞
docker-clean:
	@echo "$(RED)üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞...$(NC)"
	docker-compose -f $(COMPOSE_FILE) down --remove-orphans
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
